"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.wrapTask = wrapTask;

var _logging = require("./logging");

// Set up log emitter listening from SDK, proper error catching and throwing of SDK errors
function wrapTask(func) {
  return (ctx, task) => {
    const teardownTaskListeners = (0, _logging.logToTaskOutput)(task);
    return func(ctx, task).then(() => {
      teardownTaskListeners();
    }).catch(error => {
      teardownTaskListeners(); // Format message as human readable listr output

      const formattedMessage = (0, _logging.formatLogMessageOneLine)({
        ts: new Date().toJSON(),
        level: 'error',
        error
      });
      const enrichedError = new Error(formattedMessage); // Attach original error object for error log

      enrichedError.originalError = error;
      throw enrichedError;
    });
  };
}